DROP TABLE SUITCASE;
DROP TABLE TICKET;
DROP TABLE FLIGHT;
DROP TABLE AIRPLANE_COMPANY;
DROP TABLE PASSENGER; 

CREATE TABLE SUITCASE (
Bag_ID		    INT		    PRIMARY KEY,
Baggage_Weight	FLOAT(16)	NOT NULL,
Passport_Number	INT		    NOT NULL
 );
 
CREATE TABLE AIRPLANE_COMPANY (
Airline_Name	VARCHAR(30)	PRIMARY KEY,
Home_Country 	VARCHAR(30)	NOT NULL,
Phone_Number 	INT		    NOT NULL
 );

CREATE TABLE FLIGHT (
Flight_Number	    VARCHAR(30)	    PRIMARY KEY,
Departure_Airport 	VARCHAR(30)     NOT NULL,
Departure_Time  	DATE       	    NOT NULL,
Arrival_Airport 	VARCHAR(30)	    NOT NULL,
Arrival_Time   		DATE       	    NOT NULL,
Seat_Capacity 	    VARCHAR(30)   	NOT NULL,
Airline_Name   	    VARCHAR(30)     NOT NULL,
FOREIGN KEY (Airline_Name) REFERENCES AIRPLANE_COMPANY (Airline_Name) ON DELETE CASCADE
 );

CREATE TABLE PASSENGER (
Passport_Number	INT		        PRIMARY KEY, 
DOB			    VARCHAR(30)	    NOT NULL,
First_Name		VARCHAR(30)	    NOT NULL,
Last_Name		VARCHAR(30)	    NOT NULL
 );
 
 CREATE TABLE TICKET (
	Ticket_Number	    INT			    PRIMARY KEY,
	Seat_Number         VARCHAR(12)     NOT NULL,
	Class               VARCHAR(10)     NOT NULL,
    Flight_Number       VARCHAR(30)     NOT NULL,
	Passport_Number     INT             NOT NULL,
    CONSTRAINT FK2
    FOREIGN KEY (Flight_Number) REFERENCES FLIGHT (Flight_Number) ON DELETE CASCADE,
    CONSTRAINT FK3
    FOREIGN KEY(Passport_Number) REFERENCES PASSENGER(Passport_Number) ON DELETE CASCADE
);
 


INSERT INTO AIRPLANE_COMPANY VALUES('Air India', 'India', 8886341407 );
INSERT INTO AIRPLANE_COMPANY VALUES('Emirates','Dubai', 8007773999);
INSERT INTO AIRPLANE_COMPANY VALUES('Delta', 'USA',8002211212);


ALTER TABLE AIRPLANE_COMPANY
ADD CONSTRAINT Airline_Name UNIQUE (Airline_Name, Home_Country, Phone_Number);
ALTER SESSION SET NLS_DATE_FORMAT = 'DD-MM-YYYY HH24:MI:SS';

INSERT INTO FLIGHT
VALUES ('7894672', 'DAL', '30-12-2021 09:00:00', 'EWR', '30-12-2021 12:00:00', 175, 'Delta');
INSERT INTO FLIGHT
VALUES ('7894676', 'IND', '30-12-2021 13:45:00', 'EWR', '30-12-2021 14:45:00', 150, 'Delta');
INSERT INTO FLIGHT
VALUES ('89012388', 'JFK', '30-12-2021 14:00:00', 'LAX', '30-12-2021 17:00:00', 180, 'Delta');
INSERT INTO FLIGHT
VALUES ('92317532', 'DEL', '30-12-2021 17:30:00','JFK', '31-12-2021 16:30:00', 250, 'Air India');


INSERT INTO SUITCASE VALUES(31500751, 35.17, 89013628);
INSERT INTO SUITCASE VALUES(31500876, 23.14, 10095672);
INSERT INTO SUITCASE VALUES(31509841, 18.9,  89100672);


INSERT INTO PASSENGER VALUES(89013628, '30-05-2003', 'Ruby', 'Kapoor');
INSERT INTO PASSENGER VALUES(10095672, '01-12-2001', 'Jason', 'Zheng');
INSERT INTO PASSENGER VALUES(89100672, '08 -05-2002', 'Moksha', 'Annigeri');

INSERT INTO TICKET VALUES (10010089, '34A', 'Business', '7894672', 89013628);
INSERT INTO TICKET VALUES (10010088, '34B', 'Business', '89012388', 10095672);
INSERT INTO TICKET VALUES(10892233, '14C', 'First', '92317532', 89100672);


SELECT *
FROM AIRPLANE_COMPANY;

SELECT *
FROM FLIGHT;

SELECT *
FROM SUITCASE;

SELECT *
FROM TICKET;

SELECT *
FROM PASSENGER;

/*INSERTS FOR DEMO */

INSERT INTO AIRPLANE_COMPANY VALUES('Singapore Airline', 'Singapore', 8008654114);
INSERT INTO AIRPLANE_COMPANY VALUES('Spirit', 'USA', 8557283555);

SELECT *
FROM AIRPLANE_COMPANY;
/*
INSERT INTO FLIGHT
VALUES ('89013424', 'DXB', '31-12-2021 8:00:00','SIN', '31-12-2021 14:45:00', 175, 'Emirates');
INSERT INTO FLIGHT
VALUES ('41453212', 'SIN', '31-12-2021 20:30:00','DXB', '31-12-2021 2:30:00', 200, 'Singapore Airline');

SELECT *
FROM FLIGHT;

INSERT INTO SUITCASE VALUES(87663888, 10.8, 89013897);
INSERT INTO SUITCASE VALUES(88878999, 40.10, 90018527);

SELECT *
FROM SUITCASE;

INSERT INTO PASSENGER VALUES(89013897, '08-01-2001', 'Jerry', 'Zheng');
INSERT INTO PASSENGER VALUES(90018527,  '15-06-2004', 'Angel', 'Zheng');

SELECT *
FROM PASSENGER;

INSERT INTO TICKET VALUES(10567000, '27A', 'First', '89013424', 89013897);
INSERT INTO TICKET VALUES (10567001, '47A', 'Economy', '41453212', 90018527);


SELECT *
FROM TICKET;
*/



/* UPDATE AND DELETE STMTS FOR EVERY TABLE */
UPDATE AIRPLANE_COMPANY
SET Phone_Number = 8991097878
WHERE Airline_Name = 'Delta';

SELECT *
FROM AIRPLANE_COMPANY;

DELETE FROM AIRPLANE_COMPANY
WHERE Airline_Name = 'Spirit';

SELECT *
FROM AIRPLANE_COMPANY;
/*
UPDATE FLIGHT
SET Arrival_Time = '30-12-2019 15:00:00'
WHERE Flight_Number = '7894672';

SELECT *
FROM FLIGHT;

UPDATE SUITCASE
SET Baggage_Weight = 29.5
WHERE Bag_ID = '31500751';

SELECT *
FROM SUITCASE;

DELETE FROM SUITCASE
WHERE Bag_ID = '31509841';

SELECT *
FROM SUITCASE;


UPDATE TICKET
SET Seat_Number = '29A'
WHERE Ticket_Number = 10567001;

SELECT *
FROM TICKET;

UPDATE PASSENGER
SET First_Name = 'Vidhi'
WHERE Passport_Number = 89013897;


SELECT *
FROM PASSENGER;


DELETE FROM PASSENGER
WHERE First_Name = 'Jason';


SELECT *
FROM PASSENGER;

DELETE FROM TICKET
WHERE Class = 'Economy';

SELECT *
FROM TICKET;

DELETE FROM FLIGHT 
WHERE Arrival_Airport = 'LAX';

SELECT *
FROM FLIGHT;

*/

/*SPECIAL QUERIES */
SELECT Airline_Name
FROM FLIGHT
GROUP BY Airline_Name
HAVING COUNT(*) >= 2;

SELECT Class, COUNT (Class)
FROM TICKET
GROUP BY Class;


SELECT PASSENGER.First_Name, PASSENGER.Last_Name
FROM PASSENGER
WHERE PASSENGER.Passport_Number IN (SELECT PASSENGER.Passport_Number
                                    FROM TICKET, PASSENGER
                                    WHERE PASSENGER.DOB > '06-NOV-2000' AND PASSENGER.Passport_Number = TICKET.Passport_Number);


SELECT Airline_Name, Flight_Number
FROM FLIGHT
WHERE Seat_Capacity > ALL (SELECT Seat_Capacity
                           FROM FLIGHT
                           WHERE Airline_Name = 'Delta');

                

